# 手術室シフト表作成システム - 理想設計書

## システム概要

看護師が個別にシフト希望を入力し、締め切り後に管理者が公平なシフト表を自動生成するWebアプリケーション。

## 機能要件

### 1. 個人用シフト希望入力ページ（プライベートページ）

#### 1.1 認証・識別
- 看護師名（またはID）でログイン
- パスワード認証（オプション：簡易的なものから本格的な認証まで）
- セッション管理（ブラウザを閉じてもログイン状態を保持）

#### 1.2 希望入力フォーム
- **カレンダー形式の入力画面**
  - 月間カレンダー表示（2025年8月）
  - 各日に以下の選択肢から選択：
    - 希望なし（終日勤務可能）
    - 日勤不可
    - 夜勤不可
    - 有給休暇希望
  - 一括選択機能（例：毎週日曜を「有給休暇希望」に設定）
- **備考欄**
  - 有給希望
  - 旅行予定
  - 通院
  - その他（自由記述）
- **入力状況の表示**
  - 入力済み日数/総日数
  - 未入力日のハイライト

#### 1.3 データ保存
- リアルタイム自動保存（入力と同時に保存）
- 下書き保存機能
- 提出機能（提出後は編集不可）

#### 1.4 表示機能
- 入力済み希望の確認・表示
- 提出状態の確認（提出済み/未提出）

### 2. 締め切り管理機能

#### 2.1 締め切り設定
- 管理者が締め切り日時を設定
- 締め切り日時の表示（全ユーザーに通知）

#### 2.2 締め切り時の動作
- 自動的に希望入力を受け付け停止
- 未提出者の一覧表示
- 締め切り後は編集不可（管理者の特別権限を除く）

#### 2.3 締め切り前の通知
- 締め切り日時のカウントダウン表示
- 締め切り間近の警告表示（例：3日前、1日前）

### 3. 管理者用シフト生成ページ（中央管理）

#### 3.1 ダッシュボード
- **提出状況の確認**
  - 提出済み/未提出の看護師一覧
  - 提出率の表示
- **希望データの一覧表示**
  - 全看護師の希望を表形式で表示
  - フィルタリング機能（提出済みのみ、未提出のみ）
- **CSVエクスポート**
  - 全希望データをCSV形式でダウンロード

#### 3.2 シフト生成機能
- **設定項目**
  - 日勤必要人数
  - 夜勤必要人数
  - 1ヶ月の目標勤務日数
  - その他の制約条件
- **自動生成**
  - 公平性を考慮したシフト表の自動生成
  - 生成時間の表示
- **結果確認**
  - 生成されたシフト表の表示
  - 公平性統計の表示
  - 希望違反の確認
- **調整機能**
  - 手動での個別調整
  - 再生成機能
- **エクスポート**
  - CSV形式でのダウンロード
  - PDF形式での出力（オプション）

#### 3.3 公平性分析
- 看護師ごとの統計：
  - 勤務日数
  - 夜勤回数
  - 週末休日数
  - 希望違反回数
- 公平性スコアの表示
- 改善提案の表示

### 4. 通知・お知らせ機能

#### 4.1 お知らせ表示
- システム全体のお知らせ
- 締め切り日時の通知
- シフト表公開の通知

#### 4.2 通知方法
- ページ内での表示
- メール通知（オプション）
- LINE通知（オプション）

## 技術要件

### フロントエンド
- HTML/CSS/JavaScript
- レスポンシブデザイン（モバイル対応）
- モダンなUI/UX

### データ保存（簡易版）
- **LocalStorage**：ブラウザ内に保存
  - 各看護師の希望データ
  - 締め切り設定
  - 生成されたシフト表
- **メリット**：サーバー不要、すぐに使える
- **デメリット**：ブラウザ依存、共有不可

### データ保存（本格版）
- **バックエンドAPI**
  - Node.js + Express / Python + Flask など
  - RESTful API設計
- **データベース**
  - SQLite（小規模） / PostgreSQL / MySQL
  - テーブル設計：
    - users（看護師情報）
    - shift_requests（希望データ）
    - schedules（生成されたシフト表）
    - deadlines（締め切り設定）
    - announcements（お知らせ）

### 認証・セキュリティ
- セッション管理
- パスワードハッシュ化
- CSRF対策
- XSS対策

## 画面遷移図

```
[ログインページ]
    ↓
[個人用希望入力ページ]
    ├─→ 希望入力・編集
    ├─→ 提出
    └─→ 入力状況確認

[管理者ログインページ]
    ↓
[管理者ダッシュボード]
    ├─→ 提出状況確認
    ├─→ 希望データ一覧
    ├─→ 締め切り設定
    ├─→ シフト生成
    └─→ シフト表管理
```

## データフロー

1. **希望入力フェーズ**
   - 看護師が個別ページで希望を入力
   - データが保存される
   - 提出ボタンで最終確定

2. **締め切りフェーズ**
   - 締め切り日時が来ると自動的に入力を受け付け停止
   - 管理者が提出状況を確認

3. **シフト生成フェーズ**
   - 管理者が希望データを確認
   - 設定を入力してシフト表を生成
   - 公平性を確認・調整

4. **公開フェーズ**
   - 生成されたシフト表を公開
   - 看護師が各自のシフトを確認

## 実装フェーズ

### フェーズ1：基本機能（現在の実装）
- ✅ CSVからのシフト生成
- ✅ 公平性計算

### フェーズ2：個人入力機能
- ログイン機能
- 個人用希望入力ページ
- LocalStorageでの保存

### フェーズ3：締め切り管理
- 締め切り設定機能
- 締め切り時の自動ロック
- 提出状況管理

### フェーズ4：管理者機能強化
- ダッシュボード
- 提出状況表示
- 一括管理機能

### フェーズ5：本格的なバックエンド（オプション）
- サーバーサイド実装
- データベース連携
- 本格的な認証

## UI/UX要件

- **使いやすさ**：直感的な操作
- **視認性**：カレンダー形式で見やすい
- **レスポンシブ**：スマホでも操作可能
- **アクセシビリティ**：色だけでなくアイコンや文字で識別可能
- **パフォーマンス**：スムーズな動作

## セキュリティ要件

- 個人情報の保護
- データの改ざん防止
- 適切なアクセス制御
- セキュアな通信（HTTPS）

